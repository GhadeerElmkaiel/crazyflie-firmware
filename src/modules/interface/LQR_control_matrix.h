#include <stdint.h>
#include <stdlib.h>
#include "controller_floaty.h"

// const float K_matrix[4][F_ERR_DIM] = {
//     {0.25, -0.25, -0.7906, 0.1255, -0.69, -0.2294, 4.4585, -0.1313, -0.0707, 0.3622, 0.1032, -0.0498, 0.516, 0.0902, -0.3995, -0.0947},
//     {-0.25, -0.25, 0.7906, -0.1255, -0.69, 0.2294, 4.4585, 0.1313, -0.0707, 0.3622, -0.1032, -0.0498, 0.0902, 0.516, -0.0947, -0.3995},
//     {-0.25, 0.25, -0.7906, -0.1255, 0.69, -0.2294, -4.4585, 0.1313, -0.0707, -0.3622, -0.1032, -0.0498, -0.3995, -0.0947, 0.516, 0.0902},
//     {0.25, 0.25, 0.7906, 0.1255, 0.69, 0.2294, -4.4585, -0.1313, -0.0707, -0.3622, 0.1032, -0.0498, -0.0947, -0.3995, 0.0902, 0.516}
//     };


// const float K_matrix[4][F_ERR_DIM] = {
//     {0.25, -0.25, -0.7906, 0.1283, -0.527, -0.2093, 3.0377, -0.0619, -0.0707, 0.2536, 0.1055, -0.0461, 0.4127, 0.0203, -0.3074, -0.0236},
//     {-0.25, -0.25, 0.7906, -0.1283, -0.527, 0.2093, 3.0377, 0.0619, -0.0707, 0.2536, -0.1055, -0.0461, 0.0203, 0.4127, -0.0236, -0.3074},
//     {-0.25, 0.25, -0.7906, -0.1283, 0.527, -0.2093, -3.0377, 0.0619, -0.0707, -0.2536, -0.1055, -0.0461, -0.3074, -0.0236, 0.4127, 0.0203},
//     {0.25, 0.25, 0.7906, 0.1283, 0.527, 0.2093, -3.0377, -0.0619, -0.0707, -0.2536, 0.1055, -0.0461, -0.0236, -0.3074, 0.0203, 0.4127}
//     };

// =================================================================

// const float K_matrix[4][F_ERR_DIM] = {
//     {0.250000,    -0.250000,    -0.790569,    0.128282,    -0.527041,    -0.209277,    3.037695,    -0.061924,    -0.070711,    0.253596,    0.105453,    -0.046078,    0.412672,    0.020280,    -0.307429,    -0.023636},
//     {-0.250000,    -0.250000,    0.790569,    -0.128282,    -0.527041,    0.209277,    3.037695,    0.061924,    -0.070711,    0.253596,    -0.105453,    -0.046078,    0.020280,    0.412672,    -0.023636,    -0.307429},
//     {-0.250000,    0.250000,    -0.790569,    -0.128282,    0.527041,    -0.209277,    -3.037695,    0.061924,    -0.070711,    -0.253596,    -0.105453,    -0.046078,    -0.307429,    -0.023636,    0.412672,    0.020280},
//     {0.250000,    0.250000,    0.790569,    0.128282,    0.527041,    0.209277,    -3.037695,    -0.061924,    -0.070711,    -0.253596,    0.105453,    -0.046078,    -0.023636,    -0.307429,    0.020280,    0.412672}
//     };

// =================================================================

// const float K_matrix[4][F_ERR_DIM] ={
//     {0.250000,    -0.250000,    -0.250000,    0.134464,    -0.528401,    -0.085599,    3.037830,    -0.055919,    -0.223607,    0.253570,    0.105916,    -0.122248,    0.433410,    0.071019,    -0.287598,    0.027958},
//     {-0.250000,    -0.250000,    0.250000,    -0.134464,    -0.528401,    0.085599,    3.037830,    0.055919,    -0.223607,    0.253570,    -0.105916,    -0.122248,    0.071019,    0.433410,    0.027958,    -0.287598},
//     {-0.250000,    0.250000,    -0.250000,    -0.134464,    0.528401,    -0.085599,    -3.037830,    0.055919,    -0.223607,    -0.253570,    -0.105916,    -0.122248,    -0.287598,    0.027958,    0.433410,    0.071019},
//     {0.250000,    0.250000,    0.250000,    0.134464,    0.528401,    0.085599,    -3.037830,    -0.055919,    -0.223607,    -0.253570,    0.105916,    -0.122248,    0.027958,    -0.287598,    0.071019,    0.433410}
// };

// const float K_matrix[4][F_ERR_DIM] ={
//     {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    3.037830,    -0.055919,    -0.223607,    0.253570,    0.105916,    -0.122248,    0.433410,    0.071019,    -0.287598,    0.027958},
//     {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    3.037830,    0.055919,    -0.223607,    0.253570,    -0.105916,    -0.122248,    0.071019,    0.433410,    0.027958,    -0.287598},
//     {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -3.037830,    0.055919,    -0.223607,    -0.253570,    -0.105916,    -0.122248,    -0.287598,    0.027958,    0.433410,    0.071019},
//     {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -3.037830,    -0.055919,    -0.223607,    -0.253570,    0.105916,    -0.122248,    0.027958,    -0.287598,    0.071019,    0.433410}
// };

// =================================================================
// This gave best yaw control 

// const float K_matrix[4][F_ERR_DIM] ={
//         {1.118034,    -1.118034,    -0.353553,    0.561247,    -1.113696,    -0.115298,    3.381110,    0.310361,    -0.316228,    0.302285,    0.170619,    -0.166624,    0.554842,    0.055894,    -0.363908,    0.072210},
//         {-1.118034,    -1.118034,    0.353553,    -0.561247,    -1.113696,    0.115298,    3.381110,    -0.310361,    -0.316228,    0.302285,    -0.170619,    -0.166624,    0.055894,    0.554842,    0.072210,    -0.363908},
//         {-1.118034,    1.118034,    -0.353553,    -0.561247,    1.113696,    -0.115298,    -3.381110,    -0.310361,    -0.316228,    -0.302285,    -0.170619,    -0.166624,    -0.363908,    0.072210,    0.554842,    0.055894},
//         {1.118034,    1.118034,    0.353553,    0.561247,    1.113696,    0.115298,    -3.381110,    0.310361,    -0.316228,    -0.302285,    0.170619,    -0.166624,    0.072210,    -0.363908,    0.055894,    0.554842}
// };

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    3.381110,    0.310361,    -0.316228,    0.302285,    0.170619,    -0.166624,    0.554842,    0.055894,    -0.363908,    0.072210},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    3.381110,    -0.310361,    -0.316228,    0.302285,    -0.170619,    -0.166624,    0.055894,    0.554842,    0.072210,    -0.363908},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -3.381110,    -0.310361,    -0.316228,    -0.302285,    -0.170619,    -0.166624,    -0.363908,    0.072210,    0.554842,    0.055894},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -3.381110,    0.310361,    -0.316228,    -0.302285,    0.170619,    -0.166624,    0.072210,    -0.363908,    0.055894,    0.554842}
// };

// =================================================================

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.559017,    -0.559017,    -0.176777,    0.279511,    -0.690650,    -0.061999,    2.663720,    0.070288,    -0.158114,    0.219182,    0.085149,    -0.088513,    0.357728,    0.071102,    -0.250228,    0.002402},
//         {-0.559017,    -0.559017,    0.176777,    -0.279511,    -0.690650,    0.061999,    2.663720,    -0.070288,    -0.158114,    0.219182,    -0.085149,    -0.088513,    0.071102,    0.357728,    0.002402,    -0.250228},
//         {-0.559017,    0.559017,    -0.176777,    -0.279511,    0.690650,    -0.061999,    -2.663720,    -0.070288,    -0.158114,    -0.219182,    -0.085149,    -0.088513,    -0.250228,    0.002402,    0.357728,    0.071102},
//         {0.559017,    0.559017,    0.176777,    0.279511,    0.690650,    0.061999,    -2.663720,    0.070288,    -0.158114,    -0.219182,    0.085149,    -0.088513,    0.002402,    -0.250228,    0.071102,    0.357728}
// };


// const float K_matrix[4][F_ERR_DIM] ={
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    2.663720,    0.070288,    -0.158114,    0.219182,    0.085149,    -0.088513,    0.357728,    0.071102,    -0.250228,    0.002402},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    2.663720,    -0.070288,    -0.158114,    0.219182,    -0.085149,    -0.088513,    0.071102,    0.357728,    0.002402,    -0.250228},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -2.663720,    -0.070288,    -0.158114,    -0.219182,    -0.085149,    -0.088513,    -0.250228,    0.002402,    0.357728,    0.071102},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -2.663720,    0.070288,    -0.158114,    -0.219182,    0.085149,    -0.088513,    0.002402,    -0.250228,    0.071102,    0.357728}
// };


// =================================================================
// Ang_vel_c    ang_v_x    ang_v_y    ang_v_z 
//    20          30         20         20

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.353553,    -0.353553,    -0.353553,    0.194302,    -0.622371,    -0.125177,    3.431901,    0.107253,    -0.316228,    0.577756,    0.452960,    -0.444779,    0.893575,    0.027689,    -0.539104,    0.259508},
//         {-0.353553,    -0.353553,    0.353553,    -0.194302,    -0.622371,    0.125177,    3.431901,    -0.107253,    -0.316228,    0.577756,    -0.452960,    -0.444779,    0.027689,    0.893575,    0.259508,    -0.539104},
//         {-0.353553,    0.353553,    -0.353553,    -0.194302,    0.622371,    -0.125177,    -3.431901,    -0.107253,    -0.316228,    -0.577756,    -0.452960,    -0.444779,    -0.539104,    0.259508,    0.893575,    0.027689},
//         {0.353553,    0.353553,    0.353553,    0.194302,    0.622371,    0.125177,    -3.431901,    0.107253,    -0.316228,    -0.577756,    0.452960,    -0.444779,    0.259508,    -0.539104,    0.027689,    0.893575}
// };


// =================================================================
// Ang_vel_c    ang_v_x    ang_v_y    ang_v_z 
//    20          20         20         20

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.353553,    -0.353553,    -0.353553,    0.194302,    -0.600979,    -0.125177,    3.226025,    0.107253,    -0.316228,    0.485148,    0.452960,    -0.444779,    0.862261,    -0.003625,    -0.507791,    0.290822},
//         {-0.353553,    -0.353553,    0.353553,    -0.194302,    -0.600979,    0.125177,    3.226025,    -0.107253,    -0.316228,    0.485148,    -0.452960,    -0.444779,    -0.003625,    0.862261,    0.290822,    -0.507791},
//         {-0.353553,    0.353553,    -0.353553,    -0.194302,    0.600979,    -0.125177,    -3.226025,    -0.107253,    -0.316228,    -0.485148,    -0.452960,    -0.444779,    -0.507791,    0.290822,    0.862261,    -0.003625},
//         {0.353553,    0.353553,    0.353553,    0.194302,    0.600979,    0.125177,    -3.226025,    0.107253,    -0.316228,    -0.485148,    0.452960,    -0.444779,    0.290822,    -0.507791,    -0.003625,    0.862261}
// };


// =================================================================
// Ang_vel_c    ang_v_x    ang_v_y    ang_v_z 
//    10          20         20         20

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.353553,    -0.353553,    -0.353553,    0.199394,    -0.571398,    -0.125177,    2.943164,    0.091798,    -0.316228,    0.368664,    0.323695,    -0.320100,    0.705080,    -0.001862,    -0.419279,    0.220390},
//         {-0.353553,    -0.353553,    0.353553,    -0.199394,    -0.571398,    0.125177,    2.943164,    -0.091798,    -0.316228,    0.368664,    -0.323695,    -0.320100,    -0.001862,    0.705080,    0.220390,    -0.419279},
//         {-0.353553,    0.353553,    -0.353553,    -0.199394,    0.571398,    -0.125177,    -2.943164,    -0.091798,    -0.316228,    -0.368664,    -0.323695,    -0.320100,    -0.419279,    0.220390,    0.705080,    -0.001862},
//         {0.353553,    0.353553,    0.353553,    0.199394,    0.571398,    0.125177,    -2.943164,    0.091798,    -0.316228,    -0.368664,    0.323695,    -0.320100,    0.220390,    -0.419279,    -0.001862,    0.705080}
// };


// =================================================================
// Ang_vel_c    ang_v_x    ang_v_y    ang_v_z 
//    5          20         20         20

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.353553,    -0.353553,    -0.353553,    0.202316,    -0.549758,    -0.125177,    2.737786,    0.085795,    -0.316228,    0.292016,    0.232687,    -0.234322,    0.581258,    0.005099,    -0.348759,    0.160127},
//         {-0.353553,    -0.353553,    0.353553,    -0.202316,    -0.549758,    0.125177,    2.737786,    -0.085795,    -0.316228,    0.292016,    -0.232687,    -0.234322,    0.005099,    0.581258,    0.160127,    -0.348759},
//         {-0.353553,    0.353553,    -0.353553,    -0.202316,    0.549758,    -0.125177,    -2.737786,    -0.085795,    -0.316228,    -0.292016,    -0.232687,    -0.234322,    -0.348759,    0.160127,    0.581258,    0.005099},
//         {0.353553,    0.353553,    0.353553,    0.202316,    0.549758,    0.125177,    -2.737786,    0.085795,    -0.316228,    -0.292016,    0.232687,    -0.234322,    0.160127,    -0.348759,    0.005099,    0.581258}
// };


// ==================================================================
// ============================= Kinks ==============================
// ==================================================================


// const float K_matrix[4][F_ERR_DIM] ={
//         {1.118034,    -1.118034,    -1.118034,    0.620492,    -0.660540,    -0.304367,    1.573662,    0.364643,    -0.316228,    0.257026,    0.247960,    -0.244442,    0.548012,    0.025156,    -0.298418,    0.117457},
//         {-1.118034,    -1.118034,    1.118034,    -0.620492,    -0.660540,    0.304367,    1.573662,    -0.364643,    -0.316228,    0.257026,    -0.247960,    -0.244442,    0.025156,    0.548012,    0.117457,    -0.298418},
//         {-1.118034,    1.118034,    -1.118034,    -0.620492,    0.660540,    -0.304367,    -1.573662,    -0.364643,    -0.316228,    -0.257026,    -0.247960,    -0.244442,    -0.298418,    0.117457,    0.548012,    0.025156},
//         {1.118034,    1.118034,    1.118034,    0.620492,    0.660540,    0.304367,    -1.573662,    0.364643,    -0.316228,    -0.257026,    0.247960,    -0.244442,    0.117457,    -0.298418,    0.025156,    0.548012}
// };


// ====================== Kinks fitted model ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         {1.116709,    -1.119358,    -1.115930,    0.614654,    -0.537603,    -0.297741,    0.749103,    0.581239,    -0.316822,    0.092765,    0.262538,    -0.246785,    0.371442,    -0.131698,    -0.122480,    0.277611},
//         {-1.119358,    -1.116709,    1.120134,    -0.614867,    -0.533966,    0.298902,    0.740723,    -0.584711,    -0.315633,    0.094802,    -0.262740,    -0.245856,    -0.131698,    0.372070,    0.277611,    -0.124178},
//         {-1.116709,    1.119358,    -1.115930,    -0.614654,    0.537603,    -0.297741,    -0.749103,    -0.581239,    -0.316822,    -0.092765,    -0.262538,    -0.246785,    -0.122480,    0.277611,    0.371442,    -0.131698},
//         {1.119358,    1.116709,    1.120134,    0.614867,    0.533966,    0.298902,    -0.740723,    0.584711,    -0.315633,    -0.094802,    0.262740,    -0.245856,    0.277611,    -0.124178,    -0.131698,    0.372070}
// };

// ======================== With Michael ==========================

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.022379,    -0.007065,    -0.007059,    -0.018295,    -0.008779,    -0.003772,    0.021954,    -0.244811,    -0.070831,    0.002763,    0.152936,    -0.162536,    0.237726,    -0.087594,    -0.087070,    0.226518},
//         {-0.022343,    -0.007077,    0.007083,    0.018362,    -0.008766,    0.003828,    0.021760,    0.245161,    -0.070590,    0.002857,    -0.153273,    -0.161982,    -0.087594,    0.237966,    0.226518,    -0.088255},
//         {-0.022379,    0.007065,    -0.007059,    0.018295,    0.008779,    -0.003772,    -0.021954,    0.244811,    -0.070831,    -0.002763,    -0.152936,    -0.162536,    -0.087070,    0.226518,    0.237726,    -0.087594},
//         {0.022343,    0.007077,    0.007083,    -0.018362,    0.008766,    0.003828,    -0.021760,    -0.245161,    -0.070590,    -0.002857,    0.153273,    -0.161982,    0.226518,    -0.088255,    -0.087594,    0.237966}
// };

// ======================== More control ==========================
// R 200

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.061169,    -0.011193,    -0.035294,    0.038951,    -0.015321,    -0.045029,    0.026951,    -0.131322,    -0.158386,    0.004070,    0.159776,    -0.171774,    0.242077,    -0.092602,    -0.085202,    0.232316},
//         {-0.061305,    -0.011168,    0.035416,    -0.039228,    -0.015317,    0.045232,    0.026900,    0.130974,    -0.157842,    0.004210,    -0.160146,    -0.171183,    -0.092602,    0.242371,    0.232316,    -0.086445},
//         {-0.061169,    0.011193,    -0.035294,    -0.038951,    0.015321,    -0.045029,    -0.026951,    0.131322,    -0.158386,    -0.004070,    -0.159776,    -0.171774,    -0.085202,    0.232316,    0.242077,    -0.092602},
//         {0.061305,    0.011168,    0.035416,    0.039228,    0.015317,    0.045232,    -0.026900,    -0.130974,    -0.157842,    -0.004210,    0.160146,    -0.171183,    0.232316,    -0.086445,    -0.092602,    0.242371}
// };

// ======================== Yaw control ==========================

// const float K_matrix[4][F_ERR_DIM] ={
//         {0,    0,    0,    0,    0,    0,    0.026951,    -0.131322,    -0.500859,    0.004070,    0.159776,    -0.521472,    0.340679,    0.005661,    0.013400,    0.330579},
//         {0,    0,    0,    0,    0,    0,    0.026900,    0.130974,    -0.499140,    0.004210,    -0.160146,    -0.519682,    0.005661,    0.340297,    0.330579,    0.011481},
//         {0,    0,    0,    0,    0,    0,    -0.026951,    0.131322,    -0.500859,    -0.004070,    -0.159776,    -0.521472,    0.013400,    0.330579,    0.340679,    0.005661},
//         {0,    0,    0,    0,    0,    0,    -0.026900,    -0.130974,    -0.499140,    -0.004210,    0.160146,    -0.519682,    0.330579,    0.011481,    0.005661,    0.340297}
// };

// ====================== Yaw control Gentle ======================
// R = 500

// const float K_matrix[4][F_ERR_DIM] ={
//         {0,    0,    0,    0,    0,    0,    0.011945,    -0.141300,    -0.223990,    0.002090,    0.099299,    -0.239059,    0.213869,    -0.020373,    -0.016399,    0.208782},
//         {0,    0,    0,    0,    0,    0,    0.012148,    0.141332,    -0.223223,    0.002181,    -0.099528,    -0.238241,    -0.020373,    0.213765,    0.208782,    -0.017580},
//         {0,    0,    0,    0,    0,    0,    -0.011945,    0.141300,    -0.223990,    -0.002090,    -0.099299,    -0.239059,    -0.016399,    0.208782,    0.213869,    -0.020373},
//         {0,    0,    0,    0,    0,    0,    -0.012148,    -0.141332,    -0.223223,    -0.002181,    0.099528,    -0.238241,    0.208782,    -0.017580,    -0.020373,    0.213765}
// };

// ====================== Yaw + Z control Gentle ======================
// R = 2000

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.019360,    -0.003536,    -0.111611,    0.002824,    -0.003667,    -0.046733,    0.003687,    -0.105305,    -0.111995,    0.000830,    0.048069,    -0.124005,    0.125525,    -0.012269,    -0.003856,    0.116732},
//         {-0.019369,    -0.003535,    0.111995,    -0.002824,    -0.003710,    0.046933,    0.004030,    0.105452,    -0.111611,    0.000871,    -0.048179,    -0.123578,    -0.012269,    0.125472,    0.116732,    -0.004511},
//         {-0.019360,    0.003536,    -0.111611,    -0.002824,    0.003667,    -0.046733,    -0.003687,    0.105305,    -0.111995,    -0.000830,    -0.048069,    -0.124005,    -0.003856,    0.116732,    0.125525,    -0.012269},
//         {0.019369,    0.003535,    0.111995,    0.002824,    0.003710,    0.046933,    -0.004030,    -0.105452,    -0.111611,    -0.000871,    0.048179,    -0.123578,    0.116732,    -0.004511,    -0.012269,    0.125472}
// };

// ====================== Yaw + Z control Gentle ======================
// R = 5000
// More position correction

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.050071,    -0.015789,    -0.499106,    0.035570,    -0.013503,    -0.156247,    0.007399,    -0.002197,    -0.070837,    0.002692,    0.005065,    -0.081387,    0.060809,    0.018893,    0.044944,    0.032498},
//         {-0.049929,    -0.015834,    0.500892,    -0.035409,    -0.013530,    0.156829,    0.007491,    0.002219,    -0.070584,    0.002714,    -0.005063,    -0.081095,    0.018893,    0.060692,    0.032498,    0.044721},
//         {-0.050071,    0.015789,    -0.499106,    -0.035570,    0.013503,    -0.156247,    -0.007399,    0.002197,    -0.070837,    -0.002692,    -0.005065,    -0.081387,    0.044944,    0.032498,    0.060809,    0.018893},
//         {0.049929,    0.015834,    0.500892,    0.035409,    0.013530,    0.156829,    -0.007491,    -0.002219,    -0.070584,    -0.002714,    0.005063,    -0.081095,    0.032498,    0.044721,    0.018893,    0.060692}
// };


// ===================== Yaw + roll control Gentle =====================
// R = 5000

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.000725,    -0.021782,    -0.022323,    -0.002364,    -0.025366,    -0.009611,    0.059454,    -0.019474,    -0.070831,    0.005857,    0.005855,    -0.081379,    0.050913,    0.029827,    0.029597,    0.046897},
//         {-0.000689,    -0.022925,    0.022399,    0.002386,    -0.025217,    0.009677,    0.054912,    0.019379,    -0.070590,    0.008589,    -0.005867,    -0.081103,    0.029827,    0.050779,    0.046897,    0.029213},
//         {-0.000725,    0.021782,    -0.022323,    0.002364,    0.025366,    -0.009611,    -0.059454,    0.019474,    -0.070831,    -0.005857,    -0.005855,    -0.081379,    0.029597,    0.046897,    0.050913,    0.029827},
//         {0.000689,    0.022925,    0.022399,    -0.002386,    0.025217,    0.009677,    -0.054912,    -0.019379,    -0.070590,    -0.008589,    0.005867,    -0.081103,    0.046897,    0.029213,    0.029827,    0.050779}
// };

// ===================== Yaw + roll + Pos control Gentle =====================
// R = 5000
// More position control
// Increase X position control to match Y and Z

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.224817,    -0.222390,    -0.223217,    0.122275,    -0.150491,    -0.080767,    0.136559,    0.011379,    -0.070834,    0.029074,    0.015490,    -0.081384,    0.073683,    0.017290,    0.019379,    0.046839},
//         {-0.222390,    -0.224817,    0.223996,    -0.120209,    -0.151034,    0.081079,    0.138030,    -0.011374,    -0.070587,    0.032043,    -0.015389,    -0.081099,    0.017290,    0.073751,    0.046839,    0.018879},
//         {-0.224817,    0.222390,    -0.223217,    -0.122275,    0.150491,    -0.080767,    -0.136559,    -0.011379,    -0.070834,    -0.029074,    -0.015490,    -0.081384,    0.019379,    0.046839,    0.073683,    0.017290},
//         {0.222390,    0.224817,    0.223996,    0.120209,    0.151034,    0.081079,    -0.138030,    0.011374,    -0.070587,    -0.032043,    0.015389,    -0.081099,    0.046839,    0.018879,    0.017290,    0.073751}
// };

// ===================== Yaw + roll + Pos less gentel =====================
// R 500 
// High position control
// High roll control 

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.700780,    -0.713378,    -0.705867,    0.306146,    -0.463118,    -0.204662,    0.894786,    0.090178,    -0.223998,    0.045575,    0.044533,    -0.239086,    0.188152,    0.041734,    0.041354,    0.115569},
//         {-0.713378,    -0.700780,    0.708344,    -0.310653,    -0.453011,    0.205424,    0.924256,    -0.091619,    -0.223215,    0.073260,    -0.044600,    -0.238247,    0.041734,    0.188102,    0.115569,    0.040335},
//         {-0.700780,    0.713378,    -0.705867,    -0.306146,    0.463118,    -0.204662,    -0.894786,    -0.090178,    -0.223998,    -0.045575,    -0.044533,    -0.239086,    0.041354,    0.115569,    0.188152,    0.041734},
//         {0.713378,    0.700780,    0.708344,    0.310653,    0.453011,    0.205424,    -0.924256,    0.091619,    -0.223215,    -0.073260,    0.044600,    -0.238247,    0.115569,    0.040335,    0.041734,    0.188102}
// };

// ===================== Yaw + roll + Pos less X less gentel =====================
// R 500 
// High position control
// High roll control 
// Less X control

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.069541,    -0.713378,    -0.705867,    0.041274,    -0.463118,    -0.204662,    0.894786,    0.090178,    -0.223998,    0.045575,    0.044533,    -0.239086,    0.188152,    0.041734,    0.041354,    0.115569},
//         {-0.071862,    -0.700780,    0.708344,    -0.042761,    -0.453011,    0.205424,    0.924256,    -0.091619,    -0.223215,    0.073260,    -0.044600,    -0.238247,    0.041734,    0.188102,    0.115569,    0.040335},
//         {-0.069541,    0.713378,    -0.705867,    -0.041274,    0.463118,    -0.204662,    -0.894786,    -0.090178,    -0.223998,    -0.045575,    -0.044533,    -0.239086,    0.041354,    0.115569,    0.188152,    0.041734},
//         {0.071862,    0.700780,    0.708344,    0.042761,    0.453011,    0.205424,    -0.924256,    0.091619,    -0.223215,    -0.073260,    0.044600,    -0.238247,    0.115569,    0.040335,    0.041734,    0.188102}
// };

// ===================== Yaw + roll less gentel =====================
// R 500
// High roll control
// Low position control

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.069541,    -0.071862,    -0.070589,    0.041274,    -0.202226,    -0.028971,    0.809787,    -0.038411,    -0.223990,    0.027812,    0.024295,    -0.239076,    0.143972,    0.066517,    0.056024,    0.120398},
//         {-0.071862,    -0.069541,    0.070832,    -0.042761,    -0.181119,    0.029123,    0.735654,    0.039014,    -0.223223,    0.056054,    -0.024052,    -0.238257,    0.066517,    0.142847,    0.120398,    0.055874},
//         {-0.069541,    0.071862,    -0.070589,    -0.041274,    0.202226,    -0.028971,    -0.809787,    0.038411,    -0.223990,    -0.027812,    -0.024295,    -0.239076,    0.056024,    0.120398,    0.143972,    0.066517},
//         {0.071862,    0.069541,    0.070832,    0.042761,    0.181119,    0.029123,    -0.735654,    -0.039014,    -0.223223,    -0.056054,    0.024052,    -0.238257,    0.120398,    0.055874,    0.066517,    0.142847}
// };

// ===================== Yaw + roll less gentel =====================
// R 500
// Higher roll control
// Low position control

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.068475,    -0.072878,    -0.070589,    0.040671,    -0.310944,    -0.028971,    1.786878,    -0.036942,    -0.223990,    0.052828,    0.024498,    -0.239076,    0.148421,    0.070384,    0.051575,    0.116531},
//         {-0.072878,    -0.068475,    0.070832,    -0.043435,    -0.265684,    0.029123,    1.566482,    0.039613,    -0.223223,    0.112467,    -0.023892,    -0.238257,    0.070384,    0.146473,    0.116531,    0.052248},
//         {-0.068475,    0.072878,    -0.070589,    -0.040671,    0.310944,    -0.028971,    -1.786878,    0.036942,    -0.223990,    -0.052828,    -0.024498,    -0.239076,    0.051575,    0.116531,    0.148421,    0.070384},
//         {0.072878,    0.068475,    0.070832,    0.043435,    0.265684,    0.029123,    -1.566482,    -0.039613,    -0.223223,    -0.112467,    0.023892,    -0.238257,    0.116531,    0.052248,    0.070384,    0.146473}
// };


// ===================== Yaw + roll control Manual =====================
// Manual configuration

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.000725,    -0.021782,    -0.070589,    -0.002364,    -0.025366,    -0.028971,    0.059454,    -0.019474,    -0.151995,    0.005857,    0.005855,    -0.124005,    0.050913,    0.029827,    0.029597,    0.046897},
//         {-0.000689,    -0.022925,    0.070832,    0.002386,    -0.025217,    0.029123,    0.054912,    0.019379,    -0.151411,    0.008589,    -0.005867,    -0.123578,    0.029827,    0.050779,    0.046897,    0.029213},
//         {-0.000725,    0.021782,    -0.070589,    0.002364,    0.025366,    -0.028971,    -0.059454,    0.019474,    -0.151995,    -0.005857,    -0.005855,    -0.124005,    0.029597,    0.046897,    0.050913,    0.029827},
//         {0.000689,    0.022925,    0.070832,    -0.002386,    0.025217,    0.029123,    -0.054912,    -0.019379,    -0.151411,    -0.008589,    0.005867,    -0.123578,    0.046897,    0.029213,    0.029827,    0.050779}
// };


// ===================== Methodological Yaw =====================
// Optimized Yaw aggressive (Too aggressive!!! controller saturated)

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.070239,    -0.071179,    -0.070589,    0.041780,    -0.138802,    -0.028971,    0.742362,    -0.038529,    -0.563000,    0.041695,    0.024299,    -0.152000,    0.141577,    0.064265,    0.058419,    0.122650},
//         {-0.071179,    -0.070239,    0.070832,    -0.042244,    -0.122760,    0.029123,    0.645552,    0.039032,    -0.563000,    0.064866,    -0.024040,    -0.152000,    0.064265,    0.140680,    0.122650,    0.058041},
//         {-0.070239,    0.071179,    -0.070589,    -0.041780,    0.138802,    -0.028971,    -0.742362,    0.038529,    -0.563000,    -0.041695,    -0.024299,    -0.152000,    0.058419,    0.122650,    0.141577,    0.064265},
//         {0.071179,    0.070239,    0.070832,    0.042244,    0.122760,    0.029123,    -0.645552,    -0.039032,    -0.563000,    -0.064866,    0.024040,    -0.152000,    0.122650,    0.058041,    0.064265,    0.140680}
// };


// ===================== Methodological Yaw =====================
// Optimized Yaw less aggressive

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.022210,    -0.022510,    -0.022322,    0.009024,    -0.102961,    -0.009725,    0.729121,    -0.052474,    -0.202703,    0.039353,    0.021615,    -0.062782,    0.135588,    0.067433,    0.060965,    0.122937},
//         {-0.022510,    -0.022210,    0.022399,    -0.009191,    -0.085894,    0.009810,    0.617610,    0.053196,    -0.202703,    0.061219,    -0.021318,    -0.062782,    0.067433,    0.134541,    0.122937,    0.060714},
//         {-0.022210,    0.022510,    -0.022322,    -0.009024,    0.102961,    -0.009725,    -0.729121,    0.052474,    -0.202703,    -0.039353,    -0.021615,    -0.062782,    0.060965,    0.122937,    0.135588,    0.067433},
//         {0.022510,    0.022210,    0.022399,    0.009191,    0.085894,    0.009810,    -0.617610,    -0.053196,    -0.202703,    -0.061219,    0.021318,    -0.062782,    0.122937,    0.060714,    0.067433,    0.134541}
// };


// ===================== Methodological Yaw + Z =====================
// Optimized Yaw less aggressive

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.022210,    -0.022510,    -0.9846,    0.009024,    -0.102961,    -0.44038,    0.729121,    -0.052474,    -0.202703,    0.039353,    0.021615,    -0.062782,    0.135588,    0.067433,    0.060965,    0.122937},
//         {-0.022510,    -0.022210,    0.9846,    -0.009191,    -0.085894,    0.44038,    0.617610,    0.053196,    -0.202703,    0.061219,    -0.021318,    -0.062782,    0.067433,    0.134541,    0.122937,    0.060714},
//         {-0.022210,    0.022510,    -0.9846,    -0.009024,    0.102961,    -0.44038,    -0.729121,    0.052474,    -0.202703,    -0.039353,    -0.021615,    -0.062782,    0.060965,    0.122937,    0.135588,    0.067433},
//         {0.022510,    0.022210,    0.9846,    0.009191,    0.085894,    0.44038,    -0.617610,    -0.053196,    -0.202703,    -0.061219,    0.021318,    -0.062782,    0.122937,    0.060714,    0.067433,    0.134541}
// };



// ===================== Methodological Yaw + Z Turned off flap feedback =====================
// Optimized Yaw less aggressive

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.022210,    -0.022510,    -0.9846,    0.009024,    -0.102961,    -0.44038,    0.729121,    -0.052474,    -0.202703,    0.039353,    0.021615,    -0.062782,    0.0,    0.0,    0.0,    0.0},
//         {-0.022510,    -0.022210,    0.9846,    -0.009191,    -0.085894,    0.44038,    0.617610,    0.053196,    -0.202703,    0.061219,    -0.021318,    -0.062782,    0.0,    0.0,    0.0,    0.0},
//         {-0.022210,    0.022510,    -0.9846,    -0.009024,    0.102961,    -0.44038,    -0.729121,    0.052474,    -0.202703,    -0.039353,    -0.021615,    -0.062782,    0.0,    0.0,    0.0,    0.0},
//         {0.022510,    0.022210,    0.9846,    0.009191,    0.085894,    0.44038,    -0.617610,    -0.053196,    -0.202703,    -0.061219,    0.021318,    -0.062782,    0.0,    0.0,    0.0,    0.0}
// };


// ====================== Only Roll feedback ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         {0,    0,    0,    0,    0,    0,   0.0,    0,    -0.36,    0.176,    0,    -0.1395,    0.0,    0.0,    0.0,    0.0},
//         {0,    0,    0,    0,    0,    0,   0.0,    0,    -0.36,    0.176,    0,    -0.1395,    0.0,    0.0,    0.0,    0.0},
//         {0,    0,    0,    0,    0,    0,  -0.0,    0,    -0.36,   -0.176,    0,    -0.1395,    0.0,    0.0,    0.0,    0.0},
//         {0,    0,    0,    0,    0,    0,  -0.0,    0,    -0.36,   -0.176,    0,    -0.1395,    0.0,    0.0,    0.0,    0.0}
// };

// ====================== Good Initial Roll + Z feedback ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         { 0.0,   -0.8,    -1.54,    0.00,   -0.056,    0.47,   0.6,   -0.0,    -0.36,    0.05,   -0.0,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         {-0.0,   -0.8,     1.54,   -0.00,   -0.056,   -0.47,   0.6,    0.0,    -0.36,    0.05,    0.0,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         {-0.0,    0.8,    -1.54,   -0.00,    0.056,    0.47,  -0.6,    0.0,    -0.36,   -0.05,    0.0,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         { 0.0,    0.8,     1.54,    0.00,    0.056,   -0.47,  -0.6,   -0.0,    -0.36,   -0.05,   -0.0,    -0.0494,    0.0,    0.0,    0.0,    0.0}
// };

// ====================== Good General Roll can be improved ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         { 0.4,   -0.8,    -1.84,    0.02,   -0.056,    0.67,   0.6,    0.1,    -0.36,    0.06,    0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,   -0.8,     1.84,   -0.02,   -0.056,   -0.67,   0.6,   -0.1,    -0.36,    0.06,   -0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,    0.8,    -1.84,   -0.02,    0.056,    0.67,  -0.6,   -0.1,    -0.36,   -0.06,   -0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         { 0.4,    0.8,     1.84,    0.02,    0.056,   -0.67,  -0.6,    0.1,    -0.36,   -0.06,    0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0}
// };

// ====================== Good General Controller Sys Id 1 ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         { 0.4,   -0.8,    -1.84,    0.02,   -0.056,    0.57,   0.6,    0.1,    -0.36,    0.07,    0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,   -0.8,     1.84,   -0.02,   -0.056,   -0.57,   0.6,   -0.1,    -0.36,    0.07,   -0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,    0.8,    -1.84,   -0.02,    0.056,    0.57,  -0.6,   -0.1,    -0.36,   -0.07,   -0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         { 0.4,    0.8,     1.84,    0.02,    0.056,   -0.57,  -0.6,    0.1,    -0.36,   -0.07,    0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0}
// };

// ====================== Good General Controller Sys Id 2 ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         { 0.4,   -0.8,    -2.1,    0.02,   -0.056,    0.57,   0.5,    0.12,    -0.2,    0.07,    0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,   -0.8,     2.1,   -0.02,   -0.056,   -0.57,   0.5,   -0.12,    -0.2,    0.07,   -0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,    0.8,    -2.1,   -0.02,    0.056,    0.57,  -0.5,   -0.12,    -0.2,   -0.07,   -0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0},
//         { 0.4,    0.8,     2.1,    0.02,    0.056,   -0.57,  -0.5,    0.12,    -0.2,   -0.07,    0.05,    -0.0494,    0.0,    0.0,    0.0,    0.0}
// };

// ====================== Best General Controller Sys Id 3 ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         { 0.4,   -0.2,    -0.84,    0.02,   -0.056,   -0.57,   0.6,    0.1,    -0.36,    0.07,    0.05,    -0.1,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,   -0.2,     0.84,   -0.02,   -0.056,    0.57,   0.6,   -0.1,    -0.36,    0.07,   -0.05,    -0.1,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,    0.2,    -0.84,   -0.02,    0.056,   -0.57,  -0.6,   -0.1,    -0.36,   -0.07,   -0.05,    -0.1,    0.0,    0.0,    0.0,    0.0},
//         { 0.4,    0.2,     0.84,    0.02,    0.056,    0.57,  -0.6,    0.1,    -0.36,   -0.07,    0.05,    -0.1,    0.0,    0.0,    0.0,    0.0}
// };

// ====================== Good General Controller Sys Id 4 ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         { 0.2,   -0.1,    -0.84,    0.01,   -0.04,   -0.57,   0.8,    0.15,    -0.16,    0.1,    0.03,    -0.07,    0.0,    0.0,    0.0,    0.0},
//         {-0.2,   -0.1,     0.84,   -0.01,   -0.04,    0.57,   0.8,   -0.15,    -0.16,    0.1,   -0.03,    -0.07,    0.0,    0.0,    0.0,    0.0},
//         {-0.2,    0.1,    -0.84,   -0.01,    0.04,   -0.57,  -0.8,   -0.15,    -0.16,   -0.1,   -0.03,    -0.07,    0.0,    0.0,    0.0,    0.0},
//         { 0.2,    0.1,     0.84,    0.01,    0.04,    0.57,  -0.8,    0.15,    -0.16,   -0.1,    0.03,    -0.07,    0.0,    0.0,    0.0,    0.0}
// };

// ====================== Best General Controller Sys Id 5 ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         { 0.4,   -0.2,    -0.84,    0.02,   -0.056,   -0.57,   0.6,    0.1,    -0.36,    0.07,    0.05,    -0.1,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,   -0.2,     0.84,   -0.02,   -0.056,    0.57,   0.6,   -0.1,    -0.36,    0.07,   -0.05,    -0.1,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,    0.2,    -0.84,   -0.02,    0.056,   -0.57,  -0.6,   -0.1,    -0.36,   -0.07,   -0.05,    -0.1,    0.0,    0.0,    0.0,    0.0},
//         { 0.4,    0.2,     0.84,    0.02,    0.056,    0.57,  -0.6,    0.1,    -0.36,   -0.07,    0.05,    -0.1,    0.0,    0.0,    0.0,    0.0}
// };

// ====================== Controller Sys Id 6 ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         { 0.4,   -0.2,    -0.84,    0.02,   -0.056,   -0.57,   0.7,    0.14,    -0.36,    0.06,    0.075,    -0.1,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,   -0.2,     0.84,   -0.02,   -0.056,    0.57,   0.7,   -0.14,    -0.36,    0.06,   -0.075,    -0.1,    0.0,    0.0,    0.0,    0.0},
//         {-0.4,    0.2,    -0.84,   -0.02,    0.056,   -0.57,  -0.7,   -0.14,    -0.36,   -0.06,   -0.075,    -0.1,    0.0,    0.0,    0.0,    0.0},
//         { 0.4,    0.2,     0.84,    0.02,    0.056,    0.57,  -0.7,    0.14,    -0.36,   -0.06,    0.075,    -0.1,    0.0,    0.0,    0.0,    0.0}
// };

// ====================== LQR similar to Sys Id 5 ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.157798,    -0.070852,    -0.223223,    0.188872,    -0.091678,    -0.086646,    0.442750,    0.058061,    -0.122684,    0.135657,    0.102056,    -0.072994, 0, 0, 0, 0},
//         {-0.158429,    -0.070569,    0.223990,    -0.189588,    -0.091303,    0.086986,    0.442049,    -0.062109,    -0.122264,    0.135787,    -0.101654,    -0.072739, 0, 0, 0, 0},
//         {-0.157798,    0.070852,    -0.223223,    -0.188872,    0.091678,    -0.086646,    -0.442750,    -0.058061,    -0.122684,    -0.135657,    -0.102056,    -0.072994, 0, 0, 0, 0},
//         {0.158429,    0.070569,    0.223990,    0.189588,    0.091303,    0.086986,    -0.442049,    0.062109,    -0.122264,    -0.135787,    0.101654,    -0.072739, 0, 0, 0, 0}
// };

// const float K_matrix[4][F_ERR_DIM] ={
// 		{0.158114,	-0.158114,	-0.316228,	0.104762,	-0.158305,	-0.116804,	0.789089,	0.196532,	-0.387298,	0.101375,	0.051360,	-0.143859,    0.0,    0.0,    0.0,    0.0},
// 		{-0.158114,	-0.158114,	0.316228,	-0.104762,	-0.158305,	0.116804,	0.789089,	-0.196532,	-0.387298,	0.101375,	-0.051360,	-0.143859,    0.0,    0.0,    0.0,    0.0},
// 		{-0.158114,	0.158114,	-0.316228,	-0.104762,	0.158305,	-0.116804,	-0.789089,	-0.196532,	-0.387298,	-0.101375,	-0.051360,	-0.143859,    0.0,    0.0,    0.0,    0.0},
// 		{0.158114,	0.158114,	0.316228,	0.104762,	0.158305,	0.116804,	-0.789089,	0.196532,	-0.387298,	-0.101375,	0.051360,	-0.143859,    0.0,    0.0,    0.0,    0.0}
// };

// LQR with high Z focus (leds to floaty going high up)
// const float K_matrix[4][F_ERR_DIM] ={
// 		{0.223607,	-0.223607,	-0.447214,	0.141636,	-0.199691,	-0.156526,	0.825745,	0.213069,	-0.387298,	0.102874,	0.053462,	-0.143859, 0, 0, 0 ,0},
// 		{-0.223607,	-0.223607,	0.447214,	-0.141636,	-0.199691,	0.156526,	0.825745,	-0.213069,	-0.387298,	0.102874,	-0.053462,	-0.143859, 0, 0, 0 ,0},
// 		{-0.223607,	0.223607,	-0.447214,	-0.141636,	0.199691,	-0.156526,	-0.825745,	-0.213069,	-0.387298,	-0.102874,	-0.053462,	-0.143859, 0, 0, 0 ,0},
// 		{0.223607,	0.223607,	0.447214,	0.141636,	0.199691,	0.156526,	-0.825745,	0.213069,	-0.387298,	-0.102874,	0.053462,	-0.143859, 0, 0, 0 ,0}
// };

const float K_matrix[4][F_ERR_DIM] ={
		{0.316228,	-0.223607,	-0.866025,	0.188241,	-0.181482,	-0.531743,	0.627598,	0.229788,	-0.387298,	0.082237,	0.053366,	-0.143025, 0, 0, 0 ,0},
		{-0.316228,	-0.223607,	0.866025,	-0.188241,	-0.181482,	0.531743,	0.627598,	-0.229788,	-0.387298,	0.082237,	-0.053366,	-0.143025, 0, 0, 0 ,0},
		{-0.316228,	0.223607,	-0.866025,	-0.188241,	0.181482,	-0.531743,	-0.627598,	-0.229788,	-0.387298,	-0.082237,	-0.053366,	-0.143025, 0, 0, 0 ,0},
		{0.316228,	0.223607,	0.866025,	0.188241,	0.181482,	0.531743,	-0.627598,	0.229788,	-0.387298,	-0.082237,	0.053366,	-0.143025, 0, 0, 0 ,0}
};

const int K_matrix_size = sizeof(K_matrix)/sizeof(K_matrix[0]);
