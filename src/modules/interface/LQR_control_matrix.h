#include <stdint.h>
#include <stdlib.h>
#include "controller_floaty.h"

// const float K_matrix[4][F_ERR_DIM] = {
//     {0.25, -0.25, -0.7906, 0.1255, -0.69, -0.2294, 4.4585, -0.1313, -0.0707, 0.3622, 0.1032, -0.0498, 0.516, 0.0902, -0.3995, -0.0947},
//     {-0.25, -0.25, 0.7906, -0.1255, -0.69, 0.2294, 4.4585, 0.1313, -0.0707, 0.3622, -0.1032, -0.0498, 0.0902, 0.516, -0.0947, -0.3995},
//     {-0.25, 0.25, -0.7906, -0.1255, 0.69, -0.2294, -4.4585, 0.1313, -0.0707, -0.3622, -0.1032, -0.0498, -0.3995, -0.0947, 0.516, 0.0902},
//     {0.25, 0.25, 0.7906, 0.1255, 0.69, 0.2294, -4.4585, -0.1313, -0.0707, -0.3622, 0.1032, -0.0498, -0.0947, -0.3995, 0.0902, 0.516}
//     };


// const float K_matrix[4][F_ERR_DIM] = {
//     {0.25, -0.25, -0.7906, 0.1283, -0.527, -0.2093, 3.0377, -0.0619, -0.0707, 0.2536, 0.1055, -0.0461, 0.4127, 0.0203, -0.3074, -0.0236},
//     {-0.25, -0.25, 0.7906, -0.1283, -0.527, 0.2093, 3.0377, 0.0619, -0.0707, 0.2536, -0.1055, -0.0461, 0.0203, 0.4127, -0.0236, -0.3074},
//     {-0.25, 0.25, -0.7906, -0.1283, 0.527, -0.2093, -3.0377, 0.0619, -0.0707, -0.2536, -0.1055, -0.0461, -0.3074, -0.0236, 0.4127, 0.0203},
//     {0.25, 0.25, 0.7906, 0.1283, 0.527, 0.2093, -3.0377, -0.0619, -0.0707, -0.2536, 0.1055, -0.0461, -0.0236, -0.3074, 0.0203, 0.4127}
//     };

// =================================================================

// const float K_matrix[4][F_ERR_DIM] = {
//     {0.250000,    -0.250000,    -0.790569,    0.128282,    -0.527041,    -0.209277,    3.037695,    -0.061924,    -0.070711,    0.253596,    0.105453,    -0.046078,    0.412672,    0.020280,    -0.307429,    -0.023636},
//     {-0.250000,    -0.250000,    0.790569,    -0.128282,    -0.527041,    0.209277,    3.037695,    0.061924,    -0.070711,    0.253596,    -0.105453,    -0.046078,    0.020280,    0.412672,    -0.023636,    -0.307429},
//     {-0.250000,    0.250000,    -0.790569,    -0.128282,    0.527041,    -0.209277,    -3.037695,    0.061924,    -0.070711,    -0.253596,    -0.105453,    -0.046078,    -0.307429,    -0.023636,    0.412672,    0.020280},
//     {0.250000,    0.250000,    0.790569,    0.128282,    0.527041,    0.209277,    -3.037695,    -0.061924,    -0.070711,    -0.253596,    0.105453,    -0.046078,    -0.023636,    -0.307429,    0.020280,    0.412672}
//     };

// =================================================================

// const float K_matrix[4][F_ERR_DIM] ={
//     {0.250000,    -0.250000,    -0.250000,    0.134464,    -0.528401,    -0.085599,    3.037830,    -0.055919,    -0.223607,    0.253570,    0.105916,    -0.122248,    0.433410,    0.071019,    -0.287598,    0.027958},
//     {-0.250000,    -0.250000,    0.250000,    -0.134464,    -0.528401,    0.085599,    3.037830,    0.055919,    -0.223607,    0.253570,    -0.105916,    -0.122248,    0.071019,    0.433410,    0.027958,    -0.287598},
//     {-0.250000,    0.250000,    -0.250000,    -0.134464,    0.528401,    -0.085599,    -3.037830,    0.055919,    -0.223607,    -0.253570,    -0.105916,    -0.122248,    -0.287598,    0.027958,    0.433410,    0.071019},
//     {0.250000,    0.250000,    0.250000,    0.134464,    0.528401,    0.085599,    -3.037830,    -0.055919,    -0.223607,    -0.253570,    0.105916,    -0.122248,    0.027958,    -0.287598,    0.071019,    0.433410}
// };

// const float K_matrix[4][F_ERR_DIM] ={
//     {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    3.037830,    -0.055919,    -0.223607,    0.253570,    0.105916,    -0.122248,    0.433410,    0.071019,    -0.287598,    0.027958},
//     {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    3.037830,    0.055919,    -0.223607,    0.253570,    -0.105916,    -0.122248,    0.071019,    0.433410,    0.027958,    -0.287598},
//     {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -3.037830,    0.055919,    -0.223607,    -0.253570,    -0.105916,    -0.122248,    -0.287598,    0.027958,    0.433410,    0.071019},
//     {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -3.037830,    -0.055919,    -0.223607,    -0.253570,    0.105916,    -0.122248,    0.027958,    -0.287598,    0.071019,    0.433410}
// };

// =================================================================
// This gave best yaw control 

// const float K_matrix[4][F_ERR_DIM] ={
//         {1.118034,    -1.118034,    -0.353553,    0.561247,    -1.113696,    -0.115298,    3.381110,    0.310361,    -0.316228,    0.302285,    0.170619,    -0.166624,    0.554842,    0.055894,    -0.363908,    0.072210},
//         {-1.118034,    -1.118034,    0.353553,    -0.561247,    -1.113696,    0.115298,    3.381110,    -0.310361,    -0.316228,    0.302285,    -0.170619,    -0.166624,    0.055894,    0.554842,    0.072210,    -0.363908},
//         {-1.118034,    1.118034,    -0.353553,    -0.561247,    1.113696,    -0.115298,    -3.381110,    -0.310361,    -0.316228,    -0.302285,    -0.170619,    -0.166624,    -0.363908,    0.072210,    0.554842,    0.055894},
//         {1.118034,    1.118034,    0.353553,    0.561247,    1.113696,    0.115298,    -3.381110,    0.310361,    -0.316228,    -0.302285,    0.170619,    -0.166624,    0.072210,    -0.363908,    0.055894,    0.554842}
// };

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    3.381110,    0.310361,    -0.316228,    0.302285,    0.170619,    -0.166624,    0.554842,    0.055894,    -0.363908,    0.072210},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    3.381110,    -0.310361,    -0.316228,    0.302285,    -0.170619,    -0.166624,    0.055894,    0.554842,    0.072210,    -0.363908},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -3.381110,    -0.310361,    -0.316228,    -0.302285,    -0.170619,    -0.166624,    -0.363908,    0.072210,    0.554842,    0.055894},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -3.381110,    0.310361,    -0.316228,    -0.302285,    0.170619,    -0.166624,    0.072210,    -0.363908,    0.055894,    0.554842}
// };

// =================================================================

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.559017,    -0.559017,    -0.176777,    0.279511,    -0.690650,    -0.061999,    2.663720,    0.070288,    -0.158114,    0.219182,    0.085149,    -0.088513,    0.357728,    0.071102,    -0.250228,    0.002402},
//         {-0.559017,    -0.559017,    0.176777,    -0.279511,    -0.690650,    0.061999,    2.663720,    -0.070288,    -0.158114,    0.219182,    -0.085149,    -0.088513,    0.071102,    0.357728,    0.002402,    -0.250228},
//         {-0.559017,    0.559017,    -0.176777,    -0.279511,    0.690650,    -0.061999,    -2.663720,    -0.070288,    -0.158114,    -0.219182,    -0.085149,    -0.088513,    -0.250228,    0.002402,    0.357728,    0.071102},
//         {0.559017,    0.559017,    0.176777,    0.279511,    0.690650,    0.061999,    -2.663720,    0.070288,    -0.158114,    -0.219182,    0.085149,    -0.088513,    0.002402,    -0.250228,    0.071102,    0.357728}
// };


// const float K_matrix[4][F_ERR_DIM] ={
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    2.663720,    0.070288,    -0.158114,    0.219182,    0.085149,    -0.088513,    0.357728,    0.071102,    -0.250228,    0.002402},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    2.663720,    -0.070288,    -0.158114,    0.219182,    -0.085149,    -0.088513,    0.071102,    0.357728,    0.002402,    -0.250228},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -2.663720,    -0.070288,    -0.158114,    -0.219182,    -0.085149,    -0.088513,    -0.250228,    0.002402,    0.357728,    0.071102},
//         {0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    -2.663720,    0.070288,    -0.158114,    -0.219182,    0.085149,    -0.088513,    0.002402,    -0.250228,    0.071102,    0.357728}
// };


// =================================================================
// Ang_vel_c    ang_v_x    ang_v_y    ang_v_z 
//    20          30         20         20

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.353553,    -0.353553,    -0.353553,    0.194302,    -0.622371,    -0.125177,    3.431901,    0.107253,    -0.316228,    0.577756,    0.452960,    -0.444779,    0.893575,    0.027689,    -0.539104,    0.259508},
//         {-0.353553,    -0.353553,    0.353553,    -0.194302,    -0.622371,    0.125177,    3.431901,    -0.107253,    -0.316228,    0.577756,    -0.452960,    -0.444779,    0.027689,    0.893575,    0.259508,    -0.539104},
//         {-0.353553,    0.353553,    -0.353553,    -0.194302,    0.622371,    -0.125177,    -3.431901,    -0.107253,    -0.316228,    -0.577756,    -0.452960,    -0.444779,    -0.539104,    0.259508,    0.893575,    0.027689},
//         {0.353553,    0.353553,    0.353553,    0.194302,    0.622371,    0.125177,    -3.431901,    0.107253,    -0.316228,    -0.577756,    0.452960,    -0.444779,    0.259508,    -0.539104,    0.027689,    0.893575}
// };


// =================================================================
// Ang_vel_c    ang_v_x    ang_v_y    ang_v_z 
//    20          20         20         20

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.353553,    -0.353553,    -0.353553,    0.194302,    -0.600979,    -0.125177,    3.226025,    0.107253,    -0.316228,    0.485148,    0.452960,    -0.444779,    0.862261,    -0.003625,    -0.507791,    0.290822},
//         {-0.353553,    -0.353553,    0.353553,    -0.194302,    -0.600979,    0.125177,    3.226025,    -0.107253,    -0.316228,    0.485148,    -0.452960,    -0.444779,    -0.003625,    0.862261,    0.290822,    -0.507791},
//         {-0.353553,    0.353553,    -0.353553,    -0.194302,    0.600979,    -0.125177,    -3.226025,    -0.107253,    -0.316228,    -0.485148,    -0.452960,    -0.444779,    -0.507791,    0.290822,    0.862261,    -0.003625},
//         {0.353553,    0.353553,    0.353553,    0.194302,    0.600979,    0.125177,    -3.226025,    0.107253,    -0.316228,    -0.485148,    0.452960,    -0.444779,    0.290822,    -0.507791,    -0.003625,    0.862261}
// };


// =================================================================
// Ang_vel_c    ang_v_x    ang_v_y    ang_v_z 
//    10          20         20         20

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.353553,    -0.353553,    -0.353553,    0.199394,    -0.571398,    -0.125177,    2.943164,    0.091798,    -0.316228,    0.368664,    0.323695,    -0.320100,    0.705080,    -0.001862,    -0.419279,    0.220390},
//         {-0.353553,    -0.353553,    0.353553,    -0.199394,    -0.571398,    0.125177,    2.943164,    -0.091798,    -0.316228,    0.368664,    -0.323695,    -0.320100,    -0.001862,    0.705080,    0.220390,    -0.419279},
//         {-0.353553,    0.353553,    -0.353553,    -0.199394,    0.571398,    -0.125177,    -2.943164,    -0.091798,    -0.316228,    -0.368664,    -0.323695,    -0.320100,    -0.419279,    0.220390,    0.705080,    -0.001862},
//         {0.353553,    0.353553,    0.353553,    0.199394,    0.571398,    0.125177,    -2.943164,    0.091798,    -0.316228,    -0.368664,    0.323695,    -0.320100,    0.220390,    -0.419279,    -0.001862,    0.705080}
// };


// =================================================================
// Ang_vel_c    ang_v_x    ang_v_y    ang_v_z 
//    5          20         20         20

// const float K_matrix[4][F_ERR_DIM] ={
//         {0.353553,    -0.353553,    -0.353553,    0.202316,    -0.549758,    -0.125177,    2.737786,    0.085795,    -0.316228,    0.292016,    0.232687,    -0.234322,    0.581258,    0.005099,    -0.348759,    0.160127},
//         {-0.353553,    -0.353553,    0.353553,    -0.202316,    -0.549758,    0.125177,    2.737786,    -0.085795,    -0.316228,    0.292016,    -0.232687,    -0.234322,    0.005099,    0.581258,    0.160127,    -0.348759},
//         {-0.353553,    0.353553,    -0.353553,    -0.202316,    0.549758,    -0.125177,    -2.737786,    -0.085795,    -0.316228,    -0.292016,    -0.232687,    -0.234322,    -0.348759,    0.160127,    0.581258,    0.005099},
//         {0.353553,    0.353553,    0.353553,    0.202316,    0.549758,    0.125177,    -2.737786,    0.085795,    -0.316228,    -0.292016,    0.232687,    -0.234322,    0.160127,    -0.348759,    0.005099,    0.581258}
// };


// ==================================================================
// ============================= Kinks ==============================
// ==================================================================


// const float K_matrix[4][F_ERR_DIM] ={
//         {1.118034,    -1.118034,    -1.118034,    0.620492,    -0.660540,    -0.304367,    1.573662,    0.364643,    -0.316228,    0.257026,    0.247960,    -0.244442,    0.548012,    0.025156,    -0.298418,    0.117457},
//         {-1.118034,    -1.118034,    1.118034,    -0.620492,    -0.660540,    0.304367,    1.573662,    -0.364643,    -0.316228,    0.257026,    -0.247960,    -0.244442,    0.025156,    0.548012,    0.117457,    -0.298418},
//         {-1.118034,    1.118034,    -1.118034,    -0.620492,    0.660540,    -0.304367,    -1.573662,    -0.364643,    -0.316228,    -0.257026,    -0.247960,    -0.244442,    -0.298418,    0.117457,    0.548012,    0.025156},
//         {1.118034,    1.118034,    1.118034,    0.620492,    0.660540,    0.304367,    -1.573662,    0.364643,    -0.316228,    -0.257026,    0.247960,    -0.244442,    0.117457,    -0.298418,    0.025156,    0.548012}
// };


// ====================== Kinks fitted model ======================

// const float K_matrix[4][F_ERR_DIM] ={
//         {1.116709,    -1.119358,    -1.115930,    0.614654,    -0.537603,    -0.297741,    0.749103,    0.581239,    -0.316822,    0.092765,    0.262538,    -0.246785,    0.371442,    -0.131698,    -0.122480,    0.277611},
//         {-1.119358,    -1.116709,    1.120134,    -0.614867,    -0.533966,    0.298902,    0.740723,    -0.584711,    -0.315633,    0.094802,    -0.262740,    -0.245856,    -0.131698,    0.372070,    0.277611,    -0.124178},
//         {-1.116709,    1.119358,    -1.115930,    -0.614654,    0.537603,    -0.297741,    -0.749103,    -0.581239,    -0.316822,    -0.092765,    -0.262538,    -0.246785,    -0.122480,    0.277611,    0.371442,    -0.131698},
//         {1.119358,    1.116709,    1.120134,    0.614867,    0.533966,    0.298902,    -0.740723,    0.584711,    -0.315633,    -0.094802,    0.262740,    -0.245856,    0.277611,    -0.124178,    -0.131698,    0.372070}
// };

const float K_matrix[4][F_ERR_DIM] ={
        {0.022379,    -0.007065,    -0.007059,    -0.018295,    -0.008779,    -0.003772,    0.021954,    -0.244811,    -0.070831,    0.002763,    0.152936,    -0.162536,    0.237726,    -0.087594,    -0.087070,    0.226518},
        {-0.022343,    -0.007077,    0.007083,    0.018362,    -0.008766,    0.003828,    0.021760,    0.245161,    -0.070590,    0.002857,    -0.153273,    -0.161982,    -0.087594,    0.237966,    0.226518,    -0.088255},
        {-0.022379,    0.007065,    -0.007059,    0.018295,    0.008779,    -0.003772,    -0.021954,    0.244811,    -0.070831,    -0.002763,    -0.152936,    -0.162536,    -0.087070,    0.226518,    0.237726,    -0.087594},
        {0.022343,    0.007077,    0.007083,    -0.018362,    0.008766,    0.003828,    -0.021760,    -0.245161,    -0.070590,    -0.002857,    0.153273,    -0.161982,    0.226518,    -0.088255,    -0.087594,    0.237966}
};

const int K_matrix_size = sizeof(K_matrix)/sizeof(K_matrix[0]);
